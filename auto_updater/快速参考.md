# AutoUpdater å¿«é€Ÿå‚è€ƒ

## ğŸ“‹ æ ¸å¿ƒä»£ç ç‰‡æ®µ

### æç®€é›†æˆï¼ˆ3è¡Œä»£ç ï¼‰
```python
from auto_updater import AutoUpdater

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setup_ui()

        # è‡ªåŠ¨æ›´æ–°é›†æˆ - ä»…éœ€3è¡Œä»£ç 
        self.auto_updater = AutoUpdater(self)
        self.auto_updater.setup_update_ui(self.menuBar(), "å¸®åŠ©(H)")

    def closeEvent(self, event):
        if hasattr(self, 'auto_updater'):
            self.auto_updater.cleanup()
        event.accept()
```

### æ ‡å‡†é›†æˆï¼ˆé”™è¯¯å¤„ç†ï¼‰
```python
from auto_updater import AutoUpdater, UI_AVAILABLE
import logging

logger = logging.getLogger(__name__)

def setup_auto_update(self):
    """æ ‡å‡†é›†æˆæ–¹æ¡ˆ"""
    try:
        if UI_AVAILABLE:
            self.auto_updater = AutoUpdater(self)
            success = self.auto_updater.setup_update_ui(
                self.menuBar(), "å¸®åŠ©(H)"
            )

            if success:
                logger.info("è‡ªåŠ¨æ›´æ–°åŠŸèƒ½é›†æˆæˆåŠŸ")
                self.auto_updater.enable_auto_check = True
            else:
                self.auto_updater = None

    except Exception as e:
        logger.error(f"è‡ªåŠ¨æ›´æ–°å™¨åˆå§‹åŒ–å¤±è´¥: {e}")
        self.auto_updater = None
```

### æ‰‹åŠ¨ç‰ˆæœ¬æ£€æŸ¥
```python
def check_updates_manually(self):
    """æ‰‹åŠ¨æ£€æŸ¥æ›´æ–°"""
    if not self.auto_updater:
        return

    has_update, remote_version, local_version, error = \
        self.auto_updater.check_for_updates(force_check=True)

    if has_update:
        QMessageBox.question(
            self, "å‘ç°æ–°ç‰ˆæœ¬",
            f"å½“å‰ç‰ˆæœ¬: {local_version}\næœ€æ–°ç‰ˆæœ¬: {remote_version}\n\næ˜¯å¦ä¸‹è½½ï¼Ÿ",
            QMessageBox.Yes | QMessageBox.No
        )
```

## âš™ï¸ é…ç½®æ¸…å•

### å¿…éœ€é…ç½®
```python
# auto_updater/config_constants.py
APP_NAME = "æ‚¨çš„åº”ç”¨ç¨‹åºåç§°"           # å¿…é¡»ï¼šåº”ç”¨åç§°
APP_EXECUTABLE = "your_app.exe"       # å¿…é¡»ï¼šexeæ–‡ä»¶å
CURRENT_VERSION = "1.0.0"             # å¿…é¡»ï¼šå½“å‰ç‰ˆæœ¬
GITHUB_OWNER = "your-username"        # å¿…é¡»ï¼šGitHubç”¨æˆ·å
GITHUB_REPO = "your-repo-name"        # å¿…é¡»ï¼šä»“åº“å
```

### å¯é€‰é…ç½®
```python
# ç½‘ç»œé…ç½®
TIMEOUTS = {'check': 15, 'download': 600, 'connection': 10}
RETRY = {'max_retries': 3, 'base_delay': 2}

# æ›´æ–°è¡Œä¸º
AUTO_CHECK_ENABLED = True
CHECK_INTERVAL_HOURS = 24
BACKUP_ENABLED = True
MAX_BACKUP_COUNT = 5

# UIé…ç½®
DEFAULT_LOCALE = "zh_CN"
MAIN_MENU_TEXT = "å¸®åŠ©(H)"
```

### å®‰å…¨é…ç½®
```python
# æ–‡ä»¶éªŒè¯
ENABLE_SIGNATURE_CHECK = False     # å¯ç”¨æ•°å­—ç­¾åéªŒè¯
ALLOW_PRERELEASE = False           # æ˜¯å¦å…è®¸é¢„å‘å¸ƒç‰ˆæœ¬

# ç½‘ç»œå®‰å…¨
VERIFY_SSL = True                  # SSLè¯ä¹¦éªŒè¯
USE_PROXY = False                  # ä»£ç†è®¾ç½®
```

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### æ£€æŸ¥é›†æˆçŠ¶æ€
```python
def check_integration_status(self):
    """æ£€æŸ¥è‡ªåŠ¨æ›´æ–°é›†æˆçŠ¶æ€"""
    status = {
        'updater': hasattr(self, 'auto_updater') and self.auto_updater is not None,
        'ui_available': UI_AVAILABLE,
        'version': getattr(self.auto_updater, 'current_version', 'N/A') if self.auto_updater else 'N/A'
    }
    return status
```

### æµ‹è¯•ç½‘ç»œè¿æ¥
```python
def test_github_connection(self):
    """æµ‹è¯•GitHubè¿æ¥"""
    import requests
    try:
        response = requests.get('https://api.github.com', timeout=10)
        return response.status_code == 200
    except:
        return False
```

### æ‰‹åŠ¨è§¦å‘æ›´æ–°æ£€æŸ¥
```python
def force_check_updates(self):
    """å¼ºåˆ¶æ£€æŸ¥æ›´æ–°"""
    if self.auto_updater:
        return self.auto_updater.check_for_updates(force_check=True)
    return False, None, None, "æ›´æ–°å™¨æœªåˆå§‹åŒ–"
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. å‡†å¤‡å·¥ä½œ
```bash
# å®‰è£…ä¾èµ–
pip install PyQt5 requests packaging

# å¤åˆ¶æ¨¡å—
cp -r auto_updater/ /path/to/your/project/
```

### 2. é…ç½®GitHub
```bash
# åˆ›å»ºGitHub Release
git tag v1.0.0
git push origin v1.0.0
# åœ¨GitHubç½‘é¡µä¸Šåˆ›å»ºReleaseå¹¶ä¸Šä¼ exeæ–‡ä»¶
```

### 3. æ‰“åŒ…åº”ç”¨
```bash
# ä½¿ç”¨PyInstalleræ‰“åŒ…
pyinstaller --onefile --windowed --icon=app.ico your_main.py
```

### 4. æµ‹è¯•éªŒè¯
```python
# æ£€æŸ¥æ¨¡å—å¯¼å…¥
from auto_updater import AutoUpdater
print("æ¨¡å—å¯¼å…¥æˆåŠŸ")

# æµ‹è¯•åˆå§‹åŒ–
updater = AutoUpdater(None)  # çˆ¶çª—å£å¯ä»¥ä¸ºNoneç”¨äºæµ‹è¯•
print("åˆå§‹åŒ–æˆåŠŸ")
```

## ğŸ” æ•…éšœè¯Šæ–­

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ | è¯Šæ–­å‘½ä»¤ | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| `ModuleNotFoundError` | `ls auto_updater/` | æ£€æŸ¥æ¨¡å—è·¯å¾„ |
| `ConnectionError` | `ping api.github.com` | æ£€æŸ¥ç½‘ç»œè¿æ¥ |
| `PermissionError` | `ls -la ./` | æ£€æŸ¥æ–‡ä»¶æƒé™ |
| `HTTP 403` | `curl -I https://api.github.com` | æ£€æŸ¥APIé™åˆ¶ |

### è°ƒè¯•ä»£ç 
```python
import logging
logging.basicConfig(level=logging.DEBUG)

# æ£€æŸ¥é…ç½®
from auto_updater.config_constants import *
print(f"APP_NAME: {APP_NAME}")
print(f"GITHUB_REPO: {GITHUB_REPO}")

# æµ‹è¯•æ›´æ–°å™¨
try:
    updater = AutoUpdater(None)
    print("æ›´æ–°å™¨åˆ›å»ºæˆåŠŸ")
except Exception as e:
    print(f"æ›´æ–°å™¨åˆ›å»ºå¤±è´¥: {e}")
```

## ğŸ“š é›†æˆç¤ºä¾‹æ–‡ä»¶

- `auto_updater/é›†æˆç¤ºä¾‹/minimal_example.py` - æç®€é›†æˆç¤ºä¾‹
- `auto_updater/é›†æˆç¤ºä¾‹/standard_example.py` - æ ‡å‡†é›†æˆç¤ºä¾‹
- `auto_updater/é›†æˆç¤ºä¾‹/advanced_example.py` - æ·±åº¦å®šåˆ¶ç¤ºä¾‹

## ğŸ†˜ è·å–å¸®åŠ©

1. **æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£**: `auto_updater/é›†æˆæ•™ç¨‹.md`
2. **è¿è¡Œç¤ºä¾‹ä»£ç **: å‚è€ƒ`auto_updater/é›†æˆç¤ºä¾‹/`ç›®å½•
3. **å¯ç”¨è°ƒè¯•æ—¥å¿—**: `logging.basicConfig(level=logging.DEBUG)`
4. **æ£€æŸ¥é…ç½®**: éªŒè¯`config_constants.py`ä¸­çš„è®¾ç½®
5. **æµ‹è¯•ç½‘ç»œ**: ç¡®ä¿èƒ½è®¿é—®GitHub API

---

**ç‰ˆæœ¬**: 1.0
**å¿«é€Ÿå¯¼èˆª**: [å®Œæ•´æ•™ç¨‹](./é›†æˆæ•™ç¨‹.md) | [é›†æˆç¤ºä¾‹](./é›†æˆç¤ºä¾‹/)