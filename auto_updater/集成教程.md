# AutoUpdateræ¨¡å—é›†æˆæ•™ç¨‹

## ğŸ“‹ ç›®å½•

1. [æ¨¡å—æ¦‚è¿°](#æ¨¡å—æ¦‚è¿°)
2. [âœ… é›†æˆæ£€æŸ¥æ¸…å•](#-é›†æˆæ£€æŸ¥æ¸…å•)
3. [å¿«é€Ÿå…¥é—¨](#å¿«é€Ÿå…¥é—¨)
4. [ğŸ”§ é›†æˆæ–¹æ¡ˆå¯¹æ¯”](#-é›†æˆæ–¹æ¡ˆå¯¹æ¯”)
   - [æ–¹æ¡ˆ1ï¼šæç®€é›†æˆï¼ˆæ¨èï¼‰](#æ–¹æ¡ˆ1æç®€é›†æˆæ¨è)
   - [æ–¹æ¡ˆ2ï¼šæ ‡å‡†é›†æˆ](#æ–¹æ¡ˆ2æ ‡å‡†é›†æˆ)
   - [æ–¹æ¡ˆ3ï¼šæ·±åº¦å®šåˆ¶é›†æˆ](#æ–¹æ¡ˆ3æ·±åº¦å®šåˆ¶é›†æˆ)
5. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
6. [éƒ¨ç½²å‡†å¤‡](#éƒ¨ç½²å‡†å¤‡)
7. [é«˜çº§è‡ªå®šä¹‰](#é«˜çº§è‡ªå®šä¹‰)
8. [ğŸ” æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)
9. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
10. [ğŸ“‹ å¿«é€Ÿå‚è€ƒ](#-å¿«é€Ÿå‚è€ƒ)

---

## ğŸ“– æ¨¡å—æ¦‚è¿°

### åŠŸèƒ½ç‰¹æ€§

**AutoUpdater** æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„PyQt5è‡ªåŠ¨æ›´æ–°æ¨¡å—ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- âœ… **ç‰ˆæœ¬æ£€æŸ¥**: åŸºäºGitHub APIçš„æ™ºèƒ½ç‰ˆæœ¬æ¯”è¾ƒ
- âœ… **è‡ªåŠ¨ä¸‹è½½**: å¤šçº¿ç¨‹ä¸‹è½½ï¼Œæ”¯æŒè¿›åº¦æ˜¾ç¤ºå’Œæ–­ç‚¹ç»­ä¼ 
- âœ… **å®‰å…¨å¤‡ä»½**: è‡ªåŠ¨å¤‡ä»½å½“å‰ç‰ˆæœ¬ï¼Œæ”¯æŒä¸€é”®å›æ»š
- âœ… **åŸå­æ›´æ–°**: ç¡®ä¿æ›´æ–°è¿‡ç¨‹çš„å®‰å…¨æ€§ï¼Œå¤±è´¥è‡ªåŠ¨æ¢å¤
- âœ… **UIé›†æˆ**: å®Œæ•´çš„ç”¨æˆ·ç•Œé¢ï¼ŒåŒ…æ‹¬è¿›åº¦æ¡ã€å¯¹è¯æ¡†ç­‰
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- âœ… **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„æ“ä½œæ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

### æŠ€æœ¯ç‰¹ç‚¹

- ğŸ”’ **é›¶é…ç½®æ–‡ä»¶**: ä½¿ç”¨Pythonå¸¸é‡é…ç½®ï¼Œæé«˜å®‰å…¨æ€§
- ğŸ¨ **é«˜åº¦å¯å®šåˆ¶**: æ”¯æŒæ–‡æœ¬ã€æ ·å¼ã€è¡Œä¸ºçš„å…¨é¢è‡ªå®šä¹‰
- ğŸ”„ **å®Œå…¨è§£è€¦**: UIä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œå¯ç‹¬ç«‹ä½¿ç”¨
- ğŸ›¡ï¸ **ä¼ä¸šçº§å¯é æ€§**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶

### ç³»ç»Ÿè¦æ±‚

- Python 3.7+
- PyQt5 >= 5.15.0
- requests >= 2.25.0
- packaging >= 21.0
- GitHubä»“åº“ï¼ˆç”¨äºç‰ˆæœ¬å‘å¸ƒï¼‰

---

## ğŸš€ å¿«é€Ÿå…¥é—¨

### ç¬¬ä¸€æ­¥ï¼šå¤åˆ¶æ¨¡å—

å°†æ•´ä¸ª `auto_updater` æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•ï¼š

```bash
# ä»åŸé¡¹ç›®å¤åˆ¶
cp -r /path/to/Temu_PDF_Rename_APP/auto_updater/ /path/to/your/project/

# æˆ–è€…ä¸‹è½½æ¨¡å—æ–‡ä»¶
# ï¼ˆç¡®ä¿åŒ…å«æ‰€æœ‰å­æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰
```

### ç¬¬äºŒæ­¥ï¼šå®‰è£…ä¾èµ–

ç¡®ä¿é¡¹ç›®ä¸­å·²å®‰è£…å¿…éœ€çš„ä¾èµ–ï¼š

```bash
pip install PyQt5 requests packaging
```

### ç¬¬ä¸‰æ­¥ï¼šæç®€é›†æˆï¼ˆæ¨èï¼‰

åœ¨æ‚¨çš„ä¸»çª—å£ç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```python
from PyQt5.QtWidgets import QMainWindow, QApplication
from auto_updater import AutoUpdater

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setup_ui()

        # è‡ªåŠ¨æ›´æ–°é›†æˆ - ä»…éœ€3è¡Œä»£ç 
        self.auto_updater = AutoUpdater(self)
        self.auto_updater.setup_update_ui(self.menuBar(), "å¸®åŠ©(H)")

    def setup_ui(self):
        """æ‚¨çš„UIè®¾ç½®ä»£ç """
        self.setWindowTitle("æ‚¨çš„åº”ç”¨ç¨‹åº")
        # ... å…¶ä»–UIè®¾ç½® ...

    def closeEvent(self, event):
        """åº”ç”¨é€€å‡ºæ—¶æ¸…ç†èµ„æº"""
        if hasattr(self, 'auto_updater'):
            self.auto_updater.cleanup()
        event.accept()

if __name__ == "__main__":
    app = QApplication([])
    window = MainWindow()
    window.show()
    app.exec_()
```

### ç¬¬å››æ­¥ï¼šé…ç½®åŸºæœ¬ä¿¡æ¯

ç¼–è¾‘ `auto_updater/config_constants.py`ï¼Œä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```python
# åº”ç”¨ç¨‹åºé…ç½®
APP_NAME = "æ‚¨çš„åº”ç”¨ç¨‹åºåç§°"
APP_EXECUTABLE = "your_app.exe"
CURRENT_VERSION = "1.0.0"

# GitHubé…ç½®
GITHUB_OWNER = "your-username"      # æ‚¨çš„GitHubç”¨æˆ·å
GITHUB_REPO = "your-repo-name"      # æ‚¨çš„ä»“åº“åç§°
```

### ç¬¬äº”æ­¥ï¼šæµ‹è¯•åŠŸèƒ½

1. **è¿è¡Œåº”ç”¨ç¨‹åº**ï¼šèœå•æ ä¸­ä¼šå‡ºç°"å¸®åŠ©(H)"èœå•ï¼ŒåŒ…å«"æ£€æŸ¥æ›´æ–°"å’Œ"å…³äº"é€‰é¡¹
2. **ç‰ˆæœ¬æ£€æŸ¥**ï¼šç‚¹å‡»"æ£€æŸ¥æ›´æ–°"æµ‹è¯•ç‰ˆæœ¬æ£€æŸ¥åŠŸèƒ½
3. **å‘å¸ƒç‰ˆæœ¬**ï¼šåœ¨GitHubä¸Šåˆ›å»ºReleaseæµ‹è¯•å®Œæ•´æ›´æ–°æµç¨‹

**æ­å–œï¼** ğŸ‰ æ‚¨å·²ç»æˆåŠŸé›†æˆäº†è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ï¼

---

## âœ… é›†æˆæ£€æŸ¥æ¸…å•

### åŸºç¡€é…ç½®
- [ ] **å¤åˆ¶æ¨¡å—**: å°†auto_updateræ–‡ä»¶å¤¹å¤åˆ¶åˆ°é¡¹ç›®æ ¹ç›®å½•
- [ ] **å®‰è£…ä¾èµ–**: ç¡®ä¿å·²å®‰è£…PyQt5ã€requestsã€packaging
- [ ] **ä¿®æ”¹åº”ç”¨é…ç½®**: åœ¨config_constants.pyä¸­è®¾ç½®APP_NAME
- [ ] **è®¾ç½®GitHubä¿¡æ¯**: é…ç½®GITHUB_OWNERå’ŒGITHUB_REPO
- [ ] **é…ç½®ç‰ˆæœ¬å·**: è®¾ç½®æ­£ç¡®çš„CURRENT_VERSION

### é›†æˆæµ‹è¯•
- [ ] **è¿è¡Œç¤ºä¾‹**: æ‰§è¡Œminimal_example.pyéªŒè¯åŸºç¡€åŠŸèƒ½
- [ ] **æ£€æŸ¥èœå•**: éªŒè¯èœå•æ ä¸­çš„æ›´æ–°é€‰é¡¹æ˜¯å¦æ˜¾ç¤º
- [ ] **æµ‹è¯•ç‰ˆæœ¬æ£€æŸ¥**: ç‚¹å‡»"æ£€æŸ¥æ›´æ–°"æµ‹è¯•ç½‘ç»œè¿æ¥
- [ ] **éªŒè¯é”™è¯¯å¤„ç†**: æ–­å¼€ç½‘ç»œæµ‹è¯•é”™è¯¯æç¤º
- [ ] **æŸ¥çœ‹æ—¥å¿—è¾“å‡º**: æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—æ˜¯å¦æ­£å¸¸

### ç”Ÿäº§éƒ¨ç½²
- [ ] **åˆ›å»ºGitHub Release**: åœ¨ä»“åº“ä¸­åˆ›å»ºå‘å¸ƒç‰ˆæœ¬
- [ ] **ä¸Šä¼ exeæ–‡ä»¶**: ä¸Šä¼ æ‰“åŒ…å¥½çš„åº”ç”¨ç¨‹åº
- [ ] **æµ‹è¯•å®Œæ•´æµç¨‹**: ä»æ£€æŸ¥åˆ°å®‰è£…çš„å®Œæ•´æµç¨‹
- [ ] **éªŒè¯å¤‡ä»½åŠŸèƒ½**: ç¡®ä¿å¤‡ä»½å’Œå›æ»šæ­£å¸¸å·¥ä½œ
- [ ] **é…ç½®ç”Ÿäº§æ—¥å¿—**: è®¾ç½®è¯¦ç»†çš„æ—¥å¿—è®°å½•

---

## ğŸ”§ é›†æˆæ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | æç®€é›†æˆ | æ ‡å‡†é›†æˆ | æ·±åº¦å®šåˆ¶ |
|------|---------|---------|----------|
| **ä»£ç è¡Œæ•°** | 3è¡Œ | 15è¡Œ | 80+è¡Œ |
| **é”™è¯¯å¤„ç†** | åŸºç¡€ | å®Œå–„ | è‡ªå®šä¹‰ |
| **UIæ§åˆ¶** | è‡ªåŠ¨ | éƒ¨åˆ† | å®Œå…¨ |
| **é…ç½®èƒ½åŠ›** | é»˜è®¤ | åŸºæœ¬é…ç½® | å®Œå…¨å®šåˆ¶ |
| **é€‚ç”¨åœºæ™¯** | å¿«é€ŸéªŒè¯ã€å°å‹é¡¹ç›® | ç”Ÿäº§ç¯å¢ƒã€æ ‡å‡†åº”ç”¨ | ä¼ä¸šåº”ç”¨ã€ç‰¹æ®Šéœ€æ±‚ |
| **é›†æˆæ—¶é—´** | 5åˆ†é’Ÿ | 15åˆ†é’Ÿ | 1å°æ—¶+ |
| **ç»´æŠ¤æˆæœ¬** | ä½ | ä¸­ | é«˜ |

**æ¨èé€‰æ‹©**ï¼š
- ğŸš€ **å¿«é€Ÿæ¼”ç¤º** â†’ æç®€é›†æˆ
- ğŸ­ **ç”Ÿäº§ç¯å¢ƒ** â†’ æ ‡å‡†é›†æˆ
- ğŸ¯ **ç‰¹æ®Šéœ€æ±‚** â†’ æ·±åº¦å®šåˆ¶

### æ–¹æ¡ˆ1ï¼šæç®€é›†æˆï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå¿«é€Ÿé›†æˆï¼Œä¿æŒé»˜è®¤è¡Œä¸º

**ç‰¹ç‚¹**ï¼š
- åªéœ€3è¡Œæ ¸å¿ƒä»£ç 
- è‡ªåŠ¨å¤„ç†æ‰€æœ‰UIå’Œé€»è¾‘
- ä½¿ç”¨é»˜è®¤é…ç½®å’Œè¡Œä¸º

**ä»£ç ç¤ºä¾‹**ï¼š

```python
from auto_updater import AutoUpdater

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setup_ui()

        # æç®€é›†æˆ - ä»…æ­¤è€Œå·²ï¼
        self.auto_updater = AutoUpdater(self)
        self.auto_updater.setup_update_ui(self.menuBar(), "å¸®åŠ©(H)")

    def closeEvent(self, event):
        if hasattr(self, 'auto_updater'):
            self.auto_updater.cleanup()
        event.accept()
```

**æ•ˆæœ**ï¼š
- âœ… èœå•æ è‡ªåŠ¨æ·»åŠ æ›´æ–°ç›¸å…³é€‰é¡¹
- âœ… å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥æ›´æ–°
- âœ… å®Œæ•´çš„æ›´æ–°UIå’Œè¿›åº¦æ˜¾ç¤º
- âœ… è‡ªåŠ¨å¤‡ä»½å’Œå›æ»šåŠŸèƒ½
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†

---

### æ–¹æ¡ˆ2ï¼šæ ‡å‡†é›†æˆ

**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦åŸºæœ¬è‡ªå®šä¹‰å’Œé”™è¯¯å¤„ç†

**ç‰¹ç‚¹**ï¼š
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- æ”¯æŒåŸºæœ¬é…ç½®å’ŒçŠ¶æ€ç®¡ç†
- ä¿æŒä»£ç æ•´æ´å’Œå¯ç»´æŠ¤æ€§

**ä»£ç ç¤ºä¾‹**ï¼š

```python
from auto_updater import AutoUpdater, UI_AVAILABLE
import logging

logger = logging.getLogger(__name__)

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setup_ui()
        self.setup_auto_update()

    def setup_auto_update(self):
        """æ ‡å‡†é›†æˆæ–¹æ¡ˆ"""
        try:
            if UI_AVAILABLE:
                # åˆå§‹åŒ–æ›´æ–°å™¨
                self.auto_updater = AutoUpdater(self)

                # è®¾ç½®æ›´æ–°UI
                success = self.auto_updater.setup_update_ui(
                    self.menuBar(), "å¸®åŠ©(H)"
                )

                if success:
                    logger.info("è‡ªåŠ¨æ›´æ–°åŠŸèƒ½é›†æˆæˆåŠŸ")

                    # å¯é€‰ï¼šè‡ªå®šä¹‰é…ç½®
                    self.auto_updater.enable_auto_check = True
                    self.auto_updater.check_interval = 24 * 3600  # 24å°æ—¶

                else:
                    logger.warning("è‡ªåŠ¨æ›´æ–°åŠŸèƒ½é›†æˆå¤±è´¥")
                    self.auto_updater = None

            else:
                logger.warning("UIæ¨¡å—ä¸å¯ç”¨ï¼Œè·³è¿‡è‡ªåŠ¨æ›´æ–°åŠŸèƒ½")
                self.auto_updater = None

        except Exception as e:
            logger.error(f"è‡ªåŠ¨æ›´æ–°å™¨åˆå§‹åŒ–å¤±è´¥: {e}")
            self.auto_updater = None

    def setup_ui(self):
        """æ‚¨çš„UIè®¾ç½®ä»£ç """
        self.setWindowTitle("æ‚¨çš„åº”ç”¨ç¨‹åº")
        # ... å…¶ä»–UIè®¾ç½® ...

    def closeEvent(self, event):
        """åº”ç”¨é€€å‡ºæ¸…ç†"""
        if hasattr(self, 'auto_updater') and self.auto_updater:
            self.auto_updater.cleanup()
            logger.info("è‡ªåŠ¨æ›´æ–°å™¨èµ„æºå·²æ¸…ç†")
        event.accept()
```

**æ–°å¢åŠŸèƒ½**ï¼š
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… å¯é…ç½®çš„æ›´æ–°æ£€æŸ¥é—´éš”
- âœ… æ¨¡å—åŒ–çš„ä»£ç ç»“æ„

---

### æ–¹æ¡ˆ3ï¼šæ·±åº¦å®šåˆ¶é›†æˆ

**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦å®Œå…¨æ§åˆ¶æ›´æ–°æµç¨‹å’ŒUI

**ç‰¹ç‚¹**ï¼š
- å®Œå…¨æ§åˆ¶æ›´æ–°æ£€æŸ¥å’ŒUIæ˜¾ç¤º
- è‡ªå®šä¹‰å¯¹è¯æ¡†å’Œäº¤äº’é€»è¾‘
- æ”¯æŒç‰¹æ®Šçš„ä¸šåŠ¡éœ€æ±‚

**ä»£ç ç¤ºä¾‹**ï¼š

```python
from auto_updater import AutoUpdater, UpdateUIManager
from auto_updater.ui.dialogs import UpdateProgressDialog
from PyQt5.QtWidgets import QMessageBox
import logging

logger = logging.getLogger(__name__)

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setup_ui()
        self.setup_custom_auto_update()

    def setup_custom_auto_update(self):
        """æ·±åº¦å®šåˆ¶é›†æˆæ–¹æ¡ˆ"""
        try:
            # åˆå§‹åŒ–æ›´æ–°å™¨
            self.auto_updater = AutoUpdater(self)

            # åˆ›å»ºç‹¬ç«‹çš„UIç®¡ç†å™¨
            self.update_ui_manager = UpdateUIManager(
                self.auto_updater, self
            )

            # æ‰‹åŠ¨è®¾ç½®èœå•é¡¹
            self.setup_custom_menu()

            # è‡ªå®šä¹‰é…ç½®
            self.configure_update_settings()

            logger.info("è‡ªå®šä¹‰è‡ªåŠ¨æ›´æ–°åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ")

        except Exception as e:
            logger.error(f"è‡ªå®šä¹‰è‡ªåŠ¨æ›´æ–°å™¨åˆå§‹åŒ–å¤±è´¥: {e}")
            self.auto_updater = None
            self.update_ui_manager = None

    def setup_custom_menu(self):
        """è®¾ç½®è‡ªå®šä¹‰æ›´æ–°èœå•"""
        help_menu = self.menuBar().addMenu("å¸®åŠ©(H)")

        # æ£€æŸ¥æ›´æ–°
        check_action = help_menu.addAction("æ£€æŸ¥æ›´æ–°")
        check_action.triggered.connect(self.custom_check_updates)

        help_menu.addSeparator()

        # å…³äºå¯¹è¯æ¡†
        about_action = help_menu.addAction("å…³äº")
        about_action.triggered.connect(self.show_custom_about)

    def custom_check_updates(self):
        """è‡ªå®šä¹‰æ›´æ–°æ£€æŸ¥æµç¨‹"""
        if not self.auto_updater:
            self.show_error("è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ä¸å¯ç”¨")
            return

        # æ˜¾ç¤ºæ£€æŸ¥çŠ¶æ€
        self.show_info("æ­£åœ¨æ£€æŸ¥æ›´æ–°...")

        # æ‰‹åŠ¨æ£€æŸ¥æ›´æ–°
        has_update, remote_version, local_version, error = \
            self.auto_updater.check_for_updates(force_check=True)

        if error:
            self.show_error(f"æ£€æŸ¥æ›´æ–°å¤±è´¥: {error}")
            return

        if has_update:
            # è‡ªå®šä¹‰æ›´æ–°ç¡®è®¤å¯¹è¯æ¡†
            reply = QMessageBox.question(
                self, "å‘ç°æ–°ç‰ˆæœ¬",
                f"å½“å‰ç‰ˆæœ¬: {local_version}\n"
                f"æœ€æ–°ç‰ˆæœ¬: {remote_version}\n\n"
                "æ˜¯å¦ç«‹å³ä¸‹è½½æ›´æ–°ï¼Ÿ",
                QMessageBox.Yes | QMessageBox.No,
                QMessageBox.Yes
            )

            if reply == QMessageBox.Yes:
                self.show_custom_update_dialog(remote_version, local_version)
        else:
            self.show_info("å·²æ˜¯æœ€æ–°ç‰ˆæœ¬")

    def show_custom_update_dialog(self, remote_version, local_version):
        """æ˜¾ç¤ºè‡ªå®šä¹‰æ›´æ–°å¯¹è¯æ¡†"""
        # åˆ›å»ºè‡ªå®šä¹‰è¿›åº¦å¯¹è¯æ¡†
        dialog = UpdateProgressDialog(self, remote_version, local_version)

        # è¿æ¥ä¸‹è½½å®Œæˆå›è°ƒ
        dialog.download_finished.connect(
            lambda success, msg: self.on_download_finished(success, msg, dialog)
        )

        # å¼€å§‹æ›´æ–°æµç¨‹
        dialog.start_update(remote_version, self.auto_updater)

    def on_download_finished(self, success, message, dialog):
        """ä¸‹è½½å®Œæˆå›è°ƒ"""
        dialog.close()

        if success:
            reply = QMessageBox.question(
                self, "æ›´æ–°ä¸‹è½½å®Œæˆ",
                "æ›´æ–°å·²ä¸‹è½½å®Œæˆï¼Œæ˜¯å¦ç«‹å³å®‰è£…ï¼Ÿ\n"
                "å®‰è£…åå°†è‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åºã€‚",
                QMessageBox.Yes | QMessageBox.No,
                QMessageBox.Yes
            )

            if reply == QMessageBox.Yes:
                # è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰çš„å®‰è£…é€»è¾‘
                self.show_info("å‡†å¤‡å®‰è£…æ›´æ–°...")
        else:
            self.show_error(f"æ›´æ–°ä¸‹è½½å¤±è´¥: {message}")

    def show_custom_about(self):
        """è‡ªå®šä¹‰å…³äºå¯¹è¯æ¡†"""
        QMessageBox.about(
            self, "å…³äº",
            "æ‚¨çš„åº”ç”¨ç¨‹åº\n\n"
            f"ç‰ˆæœ¬: {self.auto_updater.current_version if self.auto_updater else 'æœªçŸ¥'}\n"
            "è‡ªåŠ¨æ›´æ–°åŠŸèƒ½å·²é›†æˆ\n"
            "Â© 2025 æ‚¨çš„å…¬å¸"
        )

    def configure_update_settings(self):
        """é…ç½®æ›´æ–°è®¾ç½®"""
        if self.auto_updater:
            # è‡ªå®šä¹‰è®¾ç½®
            self.auto_updater.enable_auto_check = True
            self.auto_updater.check_interval = 24 * 3600  # 24å°æ—¶

            # æ›´å¤šè‡ªå®šä¹‰é…ç½®...

    def show_info(self, message):
        """æ˜¾ç¤ºä¿¡æ¯å¯¹è¯æ¡†"""
        QMessageBox.information(self, "ä¿¡æ¯", message)

    def show_error(self, message):
        """æ˜¾ç¤ºé”™è¯¯å¯¹è¯æ¡†"""
        QMessageBox.critical(self, "é”™è¯¯", message)

    def closeEvent(self, event):
        """è‡ªå®šä¹‰æ¸…ç†æµç¨‹"""
        if hasattr(self, 'auto_updater') and self.auto_updater:
            if hasattr(self, 'update_ui_manager'):
                self.update_ui_manager.cleanup()
            self.auto_updater.cleanup()
            logger.info("è‡ªå®šä¹‰è‡ªåŠ¨æ›´æ–°å™¨èµ„æºå·²æ¸…ç†")
        event.accept()
```

**è‡ªå®šä¹‰åŠŸèƒ½**ï¼š
- âœ… å®Œå…¨æ§åˆ¶æ‰€æœ‰UIå’Œäº¤äº’
- âœ… è‡ªå®šä¹‰æ›´æ–°æ£€æŸ¥æµç¨‹
- âœ… è‡ªå®šä¹‰å¯¹è¯æ¡†å’Œæ¶ˆæ¯
- âœ… è‡ªå®šä¹‰å®‰è£…é€»è¾‘
- âœ… å®Œæ•´çš„äº‹ä»¶å›è°ƒå¤„ç†

---

## âš™ï¸ é…ç½®è¯´æ˜

### åŸºç¡€é…ç½®

ç¼–è¾‘ `auto_updater/config_constants.py`ï¼š

```python
# åº”ç”¨ç¨‹åºåŸºæœ¬ä¿¡æ¯
APP_NAME = "æ‚¨çš„åº”ç”¨ç¨‹åºåç§°"           # åœ¨UIä¸­æ˜¾ç¤ºçš„åº”ç”¨å
APP_EXECUTABLE = "your_app.exe"       # æ‰“åŒ…åçš„å¯æ‰§è¡Œæ–‡ä»¶å
CURRENT_VERSION = "1.0.0"             # å½“å‰ç‰ˆæœ¬å·

# GitHubä»“åº“é…ç½®
GITHUB_OWNER = "your-username"        # GitHubç”¨æˆ·åæˆ–ç»„ç»‡å
GITHUB_REPO = "your-repo-name"        # GitHubä»“åº“åç§°
```

### ç½‘ç»œé…ç½®

```python
class NetworkConfig:
    # è¶…æ—¶è®¾ç½®ï¼ˆç§’ï¼‰
    TIMEOUTS = {
        'check': 15,        # ç‰ˆæœ¬æ£€æŸ¥è¶…æ—¶
        'download': 600,    # ä¸‹è½½è¶…æ—¶
        'connection': 10    # è¿æ¥è¶…æ—¶
    }

    # é‡è¯•è®¾ç½®
    RETRY = {
        'max_retries': 3,   # æœ€å¤§é‡è¯•æ¬¡æ•°
        'base_delay': 2     # åŸºç¡€å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰
    }

    # è¯·æ±‚å¤´
    HEADERS = {
        "Accept": "application/vnd.github.v3+json",
        "User-Agent": f"{APP_NAME}-AutoUpdater/{CURRENT_VERSION}"
    }
```

### æ›´æ–°è¡Œä¸ºé…ç½®

```python
# æ›´æ–°è®¾ç½®
AUTO_CHECK_ENABLED = True              # å¯ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥
CHECK_INTERVAL_HOURS = 24              # æ£€æŸ¥é—´éš”ï¼ˆå°æ—¶ï¼‰
BACKUP_ENABLED = True                  # å¯ç”¨è‡ªåŠ¨å¤‡ä»½
MAX_BACKUP_COUNT = 5                   # æœ€å¤§å¤‡ä»½æ•°é‡
```

### UIé…ç½®

```python
# ç•Œé¢é…ç½®
DEFAULT_LOCALE = "zh_CN"              # é»˜è®¤è¯­è¨€
WINDOW_ICON = None                    # çª—å£å›¾æ ‡è·¯å¾„
MAIN_MENU_TEXT = "å¸®åŠ©(H)"             # ä¸»èœå•æ–‡æœ¬
```

### è‡ªå®šä¹‰æ–‡æœ¬

å¦‚æœéœ€è¦ä¿®æ”¹ç•Œé¢æ–‡æœ¬ï¼Œå¯ä»¥ç¼–è¾‘ `auto_updater/ui/resources.py` ä¸­çš„ `TextResources` ç±»ï¼š

```python
class TextResources:
    """æ–‡æœ¬èµ„æºç±»"""

    # æ›´æ–°ç›¸å…³æ–‡æœ¬
    UPDATE_AVAILABLE = "å‘ç°æ–°ç‰ˆæœ¬"
    CURRENT_VERSION = "å½“å‰ç‰ˆæœ¬"
    LATEST_VERSION = "æœ€æ–°ç‰ˆæœ¬"

    # æŒ‰é’®æ–‡æœ¬
    DOWNLOAD_UPDATE = "ä¸‹è½½æ›´æ–°"
    INSTALL_UPDATE = "å®‰è£…æ›´æ–°"
    LATER = "ç¨å"

    # çŠ¶æ€æ–‡æœ¬
    CHECKING_UPDATES = "æ­£åœ¨æ£€æŸ¥æ›´æ–°..."
    DOWNLOADING_UPDATE = "æ­£åœ¨ä¸‹è½½æ›´æ–°..."
    INSTALLING_UPDATE = "æ­£åœ¨å®‰è£…æ›´æ–°..."
```

---

## ğŸš€ éƒ¨ç½²å‡†å¤‡

### GitHub Releaseè®¾ç½®

1. **åˆ›å»ºGitHubä»“åº“**ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
2. **é…ç½®Releaseæµç¨‹**ï¼š

```bash
# 1. æ ‡è®°æ–°ç‰ˆæœ¬
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0

# 2. åœ¨GitHubä¸Šåˆ›å»ºRelease
# - è®¿é—® https://github.com/your-username/your-repo/releases
# - ç‚¹å‡» "Create a new release"
# - é€‰æ‹©æ ‡ç­¾ç‰ˆæœ¬
# - æ·»åŠ å‘å¸ƒè¯´æ˜
# - ä¸Šä¼ æ‰“åŒ…å¥½çš„exeæ–‡ä»¶
```

3. **å‘å¸ƒèµ„äº§å‘½å**ï¼š
   - ç¡®ä¿exeæ–‡ä»¶åä¸ `APP_EXECUTABLE` é…ç½®ä¸€è‡´
   - å»ºè®®åŒ…å«ç‰ˆæœ¬å·ï¼š`YourApp_v1.0.0.exe`

### åº”ç”¨ç¨‹åºæ‰“åŒ…

ä½¿ç”¨PyInstalleræ‰“åŒ…æ‚¨çš„åº”ç”¨ç¨‹åºï¼š

```bash
# å®‰è£…PyInstaller
pip install pyinstaller

# æ‰“åŒ…ä¸ºå•æ–‡ä»¶
pyinstaller --onefile --windowed --icon=app.ico your_main.py

# ç”Ÿæˆçš„exeæ–‡ä»¶åœ¨ dist/ ç›®å½•ä¸‹
```

### æ‰“åŒ…è„šæœ¬ç¤ºä¾‹

åˆ›å»º `build.py`ï¼š

```python
import PyInstaller.__main__
import os
import shutil

def build_app():
    """æ„å»ºåº”ç”¨ç¨‹åº"""
    # PyInstallerå‚æ•°
    args = [
        'your_main.py',
        '--onefile',           # å•æ–‡ä»¶æ¨¡å¼
        '--windowed',          # æ— æ§åˆ¶å°çª—å£
        '--icon=app.ico',      # åº”ç”¨å›¾æ ‡
        '--name=YourApp',      # åº”ç”¨åç§°
        '--add-data=auto_updater;auto_updater',  # åŒ…å«auto_updateræ¨¡å—
        '--distpath=dist',     # è¾“å‡ºç›®å½•
        '--workpath=build',    # å·¥ä½œç›®å½•
        '--specpath=.'         # specæ–‡ä»¶ä½ç½®
    ]

    # æ‰§è¡Œæ‰“åŒ…
    PyInstaller.__main__.run(args)

    # é‡å‘½åexeæ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
    old_name = os.path.join('dist', 'YourApp.exe')
    new_name = os.path.join('dist', 'your_app.exe')

    if os.path.exists(old_name):
        shutil.move(old_name, new_name)
        print(f"æ‰“åŒ…å®Œæˆ: {new_name}")
    else:
        print("æ‰“åŒ…å¤±è´¥ï¼Œæœªæ‰¾åˆ°è¾“å‡ºæ–‡ä»¶")

if __name__ == "__main__":
    build_app()
```

### æµ‹è¯•æ›´æ–°æµç¨‹

1. **ç‰ˆæœ¬æµ‹è¯•**ï¼š
   ```python
   # åœ¨config_constants.pyä¸­è®¾ç½®è¾ƒä½çš„ç‰ˆæœ¬å·
   CURRENT_VERSION = "0.9.0"
   ```

2. **æœ¬åœ°æµ‹è¯•**ï¼š
   - è¿è¡Œåº”ç”¨ç¨‹åº
   - æ£€æŸ¥æ›´æ–°åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - éªŒè¯ä¸‹è½½å’Œå®‰è£…æµç¨‹

3. **å‘å¸ƒæµ‹è¯•**ï¼š
   - åˆ›å»ºæµ‹è¯•Release
   - ä¸Šä¼ æµ‹è¯•ç‰ˆæœ¬çš„exeæ–‡ä»¶
   - éªŒè¯å®Œæ•´æ›´æ–°æµç¨‹

---

## ğŸ¨ é«˜çº§è‡ªå®šä¹‰

### è‡ªå®šä¹‰UIç»„ä»¶

å¦‚æœéœ€è¦å®Œå…¨è‡ªå®šä¹‰UIç•Œé¢ï¼Œå¯ä»¥ç»§æ‰¿å’Œæ‰©å±•ç°æœ‰çš„ç»„ä»¶ï¼š

```python
from auto_updater.ui.dialogs import UpdateProgressDialog
from PyQt5.QtWidgets import QVBoxLayout, QLabel, QProgressBar

class CustomUpdateDialog(UpdateProgressDialog):
    """è‡ªå®šä¹‰æ›´æ–°å¯¹è¯æ¡†"""

    def __init__(self, parent, remote_version, local_version):
        super().__init__(parent, remote_version, local_version)
        self.setup_custom_ui()

    def setup_custom_ui(self):
        """è®¾ç½®è‡ªå®šä¹‰UI"""
        # æ·»åŠ è‡ªå®šä¹‰ç»„ä»¶
        layout = QVBoxLayout()

        # è‡ªå®šä¹‰æ ‡é¢˜
        title_label = QLabel("ğŸš€ å‘ç°æ–°ç‰ˆæœ¬")
        title_label.setStyleSheet("font-size: 16px; font-weight: bold;")
        layout.addWidget(title_label)

        # ç‰ˆæœ¬ä¿¡æ¯
        version_info = QLabel(f"å½“å‰ç‰ˆæœ¬: {self.local_version}\n"
                             f"æœ€æ–°ç‰ˆæœ¬: {self.remote_version}")
        layout.addWidget(version_info)

        # è¿›åº¦æ¡
        self.progress_bar = QProgressBar()
        layout.addWidget(self.progress_bar)

        self.setLayout(layout)
```

### è‡ªå®šä¹‰æ›´æ–°é€»è¾‘

```python
from auto_updater import AutoUpdater

class CustomAutoUpdater(AutoUpdater):
    """è‡ªå®šä¹‰æ›´æ–°å™¨"""

    def __init__(self, parent):
        super().__init__(parent)
        self.custom_settings = {}

    def custom_version_check(self):
        """è‡ªå®šä¹‰ç‰ˆæœ¬æ£€æŸ¥é€»è¾‘"""
        # åœ¨è¿™é‡Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„ç‰ˆæœ¬æ£€æŸ¥é€»è¾‘
        # ä¾‹å¦‚ï¼šæ£€æŸ¥ç§æœ‰æœåŠ¡å™¨ã€ä½¿ç”¨ä¸åŒçš„APIç­‰
        pass

    def custom_download_logic(self, version, callback=None):
        """è‡ªå®šä¹‰ä¸‹è½½é€»è¾‘"""
        # å®ç°ç‰¹æ®Šçš„ä¸‹è½½é€»è¾‘
        # ä¾‹å¦‚ï¼šä»å¤šä¸ªé•œåƒä¸‹è½½ã€æ–­ç‚¹ç»­ä¼ ç­‰
        pass
```

### æ’ä»¶åŒ–æ‰©å±•

```python
class UpdatePlugin:
    """æ›´æ–°æ’ä»¶åŸºç±»"""

    def __init__(self, updater):
        self.updater = updater

    def before_check(self):
        """ç‰ˆæœ¬æ£€æŸ¥å‰è°ƒç”¨"""
        pass

    def after_check(self, has_update, version_info):
        """ç‰ˆæœ¬æ£€æŸ¥åè°ƒç”¨"""
        pass

    def before_download(self, version):
        """ä¸‹è½½å‰è°ƒç”¨"""
        pass

    def after_download(self, success, file_path):
        """ä¸‹è½½åè°ƒç”¨"""
        pass

class LoggingPlugin(UpdatePlugin):
    """æ—¥å¿—æ’ä»¶"""

    def before_check(self):
        print("å¼€å§‹ç‰ˆæœ¬æ£€æŸ¥...")

    def after_check(self, has_update, version_info):
        if has_update:
            print(f"å‘ç°æ–°ç‰ˆæœ¬: {version_info}")
        else:
            print("å·²æ˜¯æœ€æ–°ç‰ˆæœ¬")

# ä½¿ç”¨æ’ä»¶
updater = AutoUpdater(parent)
logging_plugin = LoggingPlugin(updater)
updater.add_plugin(logging_plugin)
```

---

## ğŸ” æ•…éšœæ’é™¤

### æ•…éšœè¯Šæ–­å‘å¯¼

#### ğŸš¨ æ›´æ–°åŠŸèƒ½ä¸å·¥ä½œ

```mermaid
graph TD
    A[æ›´æ–°åŠŸèƒ½å¼‚å¸¸] --> B{æ£€æŸ¥ç½‘ç»œè¿æ¥}
    B -->|æ­£å¸¸| C{éªŒè¯GitHubé…ç½®}
    B -->|å¼‚å¸¸| D[æ£€æŸ¥ç½‘ç»œè®¾ç½®]
    C -->|æ­£ç¡®| E{æ£€æŸ¥æƒé™è®¾ç½®}
    C -->|é”™è¯¯| F[ä¿®æ­£ä»“åº“é…ç½®]
    E -->|æ­£å¸¸| G{æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶}
    E -->|ä¸è¶³| H[è®¾ç½®ç®¡ç†å‘˜æƒé™]
    F --> G
    G -->|æœ‰é”™è¯¯ä¿¡æ¯| I[æ ¹æ®æ—¥å¿—è§£å†³]
    G -->|æ— é”™è¯¯ä¿¡æ¯| J[è”ç³»æŠ€æœ¯æ”¯æŒ]
```

#### å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

1. **æ¨¡å—å¯¼å…¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ¨¡å—è·¯å¾„
   ls auto_updater/
   ls auto_updater/__init__.py
   ```

2. **ç½‘ç»œè¿æ¥é—®é¢˜**
   ```python
   # æµ‹è¯•GitHubè¿æ¥
   import requests
   requests.get('https://api.github.com', timeout=10)
   ```

3. **æƒé™ä¸è¶³**
   ```bash
   # ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œåº”ç”¨
   # æˆ–ä¿®æ”¹å®‰è£…ç›®å½•æƒé™
   ```

### é”™è¯¯ä»£ç å¯¹ç…§è¡¨

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| `ModuleNotFoundError` | æ¨¡å—è·¯å¾„é”™è¯¯ | æ£€æŸ¥auto_updaterä½ç½® |
| `ConnectionError` | ç½‘ç»œè¿æ¥å¤±è´¥ | æ£€æŸ¥ç½‘ç»œæˆ–ä½¿ç”¨ä»£ç† |
| `PermissionError` | æ–‡ä»¶æƒé™ä¸è¶³ | ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ |
| `HTTP 403` | APIé™åˆ¶ | é…ç½®GitHub Token |
| `TimeoutError` | ä¸‹è½½è¶…æ—¶ | å¢åŠ è¶…æ—¶æ—¶é—´ |

---

## æœ€ä½³å®è·µ

### ä»£ç ç»„ç»‡

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼š
```python
# å°†æ›´æ–°ç›¸å…³ä»£ç å°è£…åœ¨å•ç‹¬çš„æ–¹æ³•ä¸­
class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setup_ui()
        self.setup_auto_update()

    def setup_auto_update(self):
        """ä¸“é—¨å¤„ç†è‡ªåŠ¨æ›´æ–°è®¾ç½®çš„æ–¹æ³•"""
        pass

    def setup_ui(self):
        """ä¸“é—¨å¤„ç†UIè®¾ç½®çš„æ–¹æ³•"""
        pass
```

2. **é…ç½®åˆ†ç¦»**ï¼š
```python
# åˆ›å»ºä¸“é—¨çš„é…ç½®ç±»
class UpdateConfig:
    APP_NAME = "æ‚¨çš„åº”ç”¨ç¨‹åº"
    GITHUB_OWNER = "your-username"
    GITHUB_REPO = "your-repo-name"
    CURRENT_VERSION = "1.0.0"

    # ä»å¤–éƒ¨è¯»å–ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰
    @classmethod
    def load_version_from_file(cls):
        try:
            with open('version.txt', 'r') as f:
                cls.CURRENT_VERSION = f.read().strip()
        except FileNotFoundError:
            pass
```

### é”™è¯¯å¤„ç†

1. **æ¸è¿›å¼é™çº§**ï¼š

#### 2. GitHub APIé™åˆ¶

**é—®é¢˜**: ç‰ˆæœ¬æ£€æŸ¥å¤±è´¥ï¼Œæç¤ºAPIé™åˆ¶

**è§£å†³æ–¹æ¡ˆ**:
```python
# åœ¨config_constants.pyä¸­æ·»åŠ GitHub Tokenï¼ˆå¯é€‰ï¼‰
GITHUB_TOKEN = None  # æˆ– "your_github_token"

# æˆ–è€…æ·»åŠ è¯·æ±‚å¤´
HEADERS = {
    "Accept": "application/vnd.github.v3+json",
    "User-Agent": f"{APP_NAME}-AutoUpdater/{CURRENT_VERSION}"
}
```

#### 3. ç½‘ç»œè¿æ¥é—®é¢˜

**é—®é¢˜**: æ— æ³•è¿æ¥åˆ°GitHub

**è§£å†³æ–¹æ¡ˆ**:
```python
# æ£€æŸ¥ç½‘ç»œè¿æ¥
import requests
try:
    response = requests.get('https://api.github.com', timeout=10)
    print(f"GitHubè¿æ¥çŠ¶æ€: {response.status_code}")
except Exception as e:
    print(f"ç½‘ç»œè¿æ¥å¤±è´¥: {e}")

# è°ƒæ•´è¶…æ—¶è®¾ç½®
class NetworkConfig:
    TIMEOUTS = {
        'check': 30,        # å¢åŠ ç‰ˆæœ¬æ£€æŸ¥è¶…æ—¶
        'download': 1200,   # å¢åŠ ä¸‹è½½è¶…æ—¶
        'connection': 20    # å¢åŠ è¿æ¥è¶…æ—¶
    }
```

#### 4. ä¸‹è½½å¤±è´¥

**é—®é¢˜**: æ›´æ–°ä¸‹è½½ä¸­æ–­æˆ–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# æ£€æŸ¥ç£ç›˜ç©ºé—´
import shutil
total, used, free = shutil.disk_usage('/')
print(f"å¯ç”¨ç£ç›˜ç©ºé—´: {free // (1024**3)}GB")

# è°ƒæ•´é‡è¯•è®¾ç½®
class NetworkConfig:
    RETRY = {
        'max_retries': 5,   # å¢åŠ é‡è¯•æ¬¡æ•°
        'base_delay': 5     # å¢åŠ åŸºç¡€å»¶è¿Ÿ
    }
```

#### 5. æƒé™é—®é¢˜

**é—®é¢˜**: æ— æ³•åˆ›å»ºå¤‡ä»½æˆ–æ›¿æ¢æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**:
```python
# æ£€æŸ¥æ–‡ä»¶æƒé™
import os
import stat

def check_file_permissions(file_path):
    """æ£€æŸ¥æ–‡ä»¶æƒé™"""
    if os.path.exists(file_path):
        file_stat = os.stat(file_path)
        permissions = stat.filemode(file_stat.st_mode)
        print(f"æ–‡ä»¶æƒé™: {permissions}")
    else:
        print(f"æ–‡ä»¶ä¸å­˜åœ¨: {file_path}")

# æ£€æŸ¥åº”ç”¨ç¨‹åºç›®å½•æƒé™
check_file_permissions('.')
check_file_permissions('backup')
```

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

```python
import logging

# è®¾ç½®æ—¥å¿—çº§åˆ«
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('updater_debug.log'),
        logging.StreamHandler()
    ]
)

# è®¾ç½®ç‰¹å®šæ¨¡å—çš„æ—¥å¿—çº§åˆ«
logging.getLogger('auto_updater').setLevel(logging.DEBUG)
```

#### 2. æµ‹è¯•å•ä¸ªåŠŸèƒ½

```python
# æµ‹è¯•GitHubè¿æ¥
from auto_updater.github_client import GitHubClient

client = GitHubClient()
releases = client.get_releases()
print(f"è·å–åˆ° {len(releases)} ä¸ªå‘å¸ƒç‰ˆæœ¬")

# æµ‹è¯•ç‰ˆæœ¬æ¯”è¾ƒ
from packaging import version

local_version = "1.0.0"
remote_version = "1.1.0"

if version.parse(remote_version) > version.parse(local_version):
    print("éœ€è¦æ›´æ–°")
else:
    print("å·²æ˜¯æœ€æ–°ç‰ˆæœ¬")
```

#### 3. æ‰‹åŠ¨è§¦å‘æ›´æ–°

```python
# åœ¨ä»£ç ä¸­æ·»åŠ æ‰‹åŠ¨è§¦å‘æŒ‰é’®
def test_update(self):
    """æµ‹è¯•æ›´æ–°åŠŸèƒ½"""
    if hasattr(self, 'auto_updater') and self.auto_updater:
        try:
            # å¼ºåˆ¶æ£€æŸ¥æ›´æ–°
            has_update, remote_version, local_version, error = \
                self.auto_updater.check_for_updates(force_check=True)

            print(f"æ›´æ–°æ£€æŸ¥ç»“æœ: {has_update}")
            print(f"è¿œç¨‹ç‰ˆæœ¬: {remote_version}")
            print(f"æœ¬åœ°ç‰ˆæœ¬: {local_version}")
            print(f"é”™è¯¯ä¿¡æ¯: {error}")

        except Exception as e:
            print(f"æ›´æ–°æ£€æŸ¥å¼‚å¸¸: {e}")
    else:
        print("è‡ªåŠ¨æ›´æ–°å™¨æœªåˆå§‹åŒ–")
```

---

## ğŸ“‹ æœ€ä½³å®è·µ

### ä»£ç ç»„ç»‡

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼š
```python
# å°†æ›´æ–°ç›¸å…³ä»£ç å°è£…åœ¨å•ç‹¬çš„æ–¹æ³•ä¸­
class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setup_ui()
        self.setup_auto_update()

    def setup_auto_update(self):
        """ä¸“é—¨å¤„ç†è‡ªåŠ¨æ›´æ–°è®¾ç½®çš„æ–¹æ³•"""
        pass

    def setup_ui(self):
        """ä¸“é—¨å¤„ç†UIè®¾ç½®çš„æ–¹æ³•"""
        pass
```

2. **é…ç½®åˆ†ç¦»**ï¼š
```python
# åˆ›å»ºä¸“é—¨çš„é…ç½®ç±»
class UpdateConfig:
    APP_NAME = "æ‚¨çš„åº”ç”¨ç¨‹åº"
    GITHUB_OWNER = "your-username"
    GITHUB_REPO = "your-repo-name"
    CURRENT_VERSION = "1.0.0"

    # ä»å¤–éƒ¨è¯»å–ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰
    @classmethod
    def load_version_from_file(cls):
        try:
            with open('version.txt', 'r') as f:
                cls.CURRENT_VERSION = f.read().strip()
        except FileNotFoundError:
            pass
```

### é”™è¯¯å¤„ç†

1. **æ¸è¿›å¼é™çº§**ï¼š
```python
def setup_auto_update(self):
    """è®¾ç½®è‡ªåŠ¨æ›´æ–°åŠŸèƒ½"""
    try:
        # å°è¯•åˆå§‹åŒ–å®Œæ•´åŠŸèƒ½
        self.auto_updater = AutoUpdater(self)
        success = self.auto_updater.setup_update_ui(self.menuBar())

        if not success:
            # é™çº§åˆ°åŸºæœ¬åŠŸèƒ½
            self.setup_basic_update_menu()

    except ImportError:
        # æ¨¡å—ä¸å¯ç”¨ï¼Œå®Œå…¨ç¦ç”¨
        self.auto_updater = None
        self.setup_no_update_menu()

    except Exception as e:
        # å…¶ä»–é”™è¯¯ï¼Œè®°å½•ä½†ç»§ç»­è¿è¡Œ
        logging.error(f"è‡ªåŠ¨æ›´æ–°åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥: {e}")
        self.auto_updater = None
```

2. **ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º**ï¼š
```python
def handle_update_error(self, error):
    """å¤„ç†æ›´æ–°é”™è¯¯çš„ç”¨æˆ·æç¤º"""
    error_messages = {
        'network': "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®",
        'permission': "æƒé™ä¸è¶³ï¼Œè¯·ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ",
        'disk_space': "ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œè¯·æ¸…ç†åé‡è¯•",
        'github_api': "æ— æ³•è¿æ¥åˆ°GitHubï¼Œè¯·ç¨åé‡è¯•"
    }

    message = error_messages.get(error.type, "æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")
    QMessageBox.warning(self, "æ›´æ–°é”™è¯¯", message)
```

### æ€§èƒ½ä¼˜åŒ–

1. **å¼‚æ­¥æ“ä½œ**ï¼š
```python
import threading
from PyQt5.QtCore import QThread, pyqtSignal

class UpdateCheckThread(QThread):
    update_found = pyqtSignal(str, str)
    no_update = pyqtSignal()
    error_occurred = pyqtSignal(str)

    def __init__(self, updater):
        super().__init__()
        self.updater = updater

    def run(self):
        """åœ¨åå°çº¿ç¨‹ä¸­æ£€æŸ¥æ›´æ–°"""
        try:
            has_update, remote_version, local_version, error = \
                self.updater.check_for_updates()

            if error:
                self.error_occurred.emit(error)
            elif has_update:
                self.update_found.emit(remote_version, local_version)
            else:
                self.no_update.emit()

        except Exception as e:
            self.error_occurred.emit(str(e))

# åœ¨ä¸»çª—å£ä¸­ä½¿ç”¨
def check_updates_async(self):
    """å¼‚æ­¥æ£€æŸ¥æ›´æ–°"""
    self.check_thread = UpdateCheckThread(self.auto_updater)
    self.check_thread.update_found.connect(self.on_update_found)
    self.check_thread.no_update.connect(self.on_no_update)
    self.check_thread.error_occurred.connect(self.on_update_error)
    self.check_thread.start()
```

2. **ç¼“å­˜æœºåˆ¶**ï¼š
```python
class CachedGitHubClient(GitHubClient):
    """å¸¦ç¼“å­˜çš„GitHubå®¢æˆ·ç«¯"""

    def __init__(self):
        super().__init__()
        self._cache = {}
        self._cache_timeout = 3600  # 1å°æ—¶ç¼“å­˜
        self._last_check = {}

    def get_releases(self, use_cache=True):
        """è·å–å‘å¸ƒç‰ˆæœ¬ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        cache_key = 'releases'
        current_time = time.time()

        # æ£€æŸ¥ç¼“å­˜
        if (use_cache and
            cache_key in self._cache and
            cache_key in self._last_check and
            current_time - self._last_check[cache_key] < self._cache_timeout):

            return self._cache[cache_key]

        # è·å–æ–°æ•°æ®
        releases = super().get_releases()

        # æ›´æ–°ç¼“å­˜
        self._cache[cache_key] = releases
        self._last_check[cache_key] = current_time

        return releases
```

### å®‰å…¨è€ƒè™‘

1. **æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥**ï¼š
```python
import hashlib

def verify_file_integrity(file_path, expected_hash):
    """éªŒè¯æ–‡ä»¶å®Œæ•´æ€§"""
    sha256_hash = hashlib.sha256()

    with open(file_path, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            sha256_hash.update(chunk)

    return sha256_hash.hexdigest() == expected_hash

# åœ¨ä¸‹è½½å®ŒæˆåéªŒè¯
if verify_file_integrity(downloaded_file, expected_sha256):
    print("æ–‡ä»¶å®Œæ•´æ€§éªŒè¯é€šè¿‡")
else:
    print("æ–‡ä»¶å®Œæ•´æ€§éªŒè¯å¤±è´¥")
```

2. **æ•°å­—ç­¾åéªŒè¯**ï¼š
```python
import subprocess

def verify_digital_signature(file_path):
    """éªŒè¯æ•°å­—ç­¾å"""
    try:
        result = subprocess.run([
            'signtool', 'verify', '/pa', file_path
        ], capture_output=True, text=True)

        return result.returncode == 0
    except FileNotFoundError:
        # signtoolä¸å¯ç”¨
        return True  # æˆ–è€…è¿”å›Falseï¼Œå–å†³äºå®‰å…¨è¦æ±‚
```

### ç”¨æˆ·ä½“éªŒ

1. **è¿›åº¦åé¦ˆ**ï¼š
```python
def show_detailed_progress(self, progress, speed, eta):
    """æ˜¾ç¤ºè¯¦ç»†çš„ä¸‹è½½è¿›åº¦"""
    progress_text = f"ä¸‹è½½è¿›åº¦: {progress}%\n"
    progress_text += f"ä¸‹è½½é€Ÿåº¦: {speed:.2f} MB/s\n"
    progress_text += f"é¢„è®¡å‰©ä½™æ—¶é—´: {eta}"

    self.progress_label.setText(progress_text)
    self.progress_bar.setValue(progress)
```

2. **å–æ¶ˆæ”¯æŒ**ï¼š
```python
class CancellableDownloadManager(DownloadManager):
    """æ”¯æŒå–æ¶ˆçš„ä¸‹è½½ç®¡ç†å™¨"""

    def __init__(self):
        super().__init__()
        self._cancelled = False

    def cancel_download(self):
        """å–æ¶ˆä¸‹è½½"""
        self._cancelled = True

    def download_file(self, url, local_path, callback=None):
        """ä¸‹è½½æ–‡ä»¶ï¼ˆæ”¯æŒå–æ¶ˆï¼‰"""
        self._cancelled = False

        # åœ¨ä¸‹è½½å¾ªç¯ä¸­æ£€æŸ¥å–æ¶ˆçŠ¶æ€
        while downloading and not self._cancelled:
            # ä¸‹è½½é€»è¾‘
            pass

        if self._cancelled:
            self.cleanup()
            return False, "ä¸‹è½½å·²å–æ¶ˆ"
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶**ï¼šæ£€æŸ¥ `updater_debug.log` è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. **è¿è¡Œæµ‹è¯•ä»£ç **ï¼šä½¿ç”¨æ–‡ä¸­çš„è°ƒè¯•æŠ€å·§è¿›è¡Œé—®é¢˜å®šä½
3. **å‚è€ƒæºä»£ç **ï¼šæŸ¥çœ‹ `auto_updater` æ¨¡å—çš„æºä»£ç äº†è§£å®ç°ç»†èŠ‚
4. **æäº¤Issue**ï¼šåœ¨GitHubä»“åº“ä¸­æäº¤é—®é¢˜æŠ¥å‘Š

---

## ğŸ‰ ç»“è¯­

AutoUpdateræ¨¡å—ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªå®Œæ•´ã€å¯é ã€æ˜“ç”¨çš„è‡ªåŠ¨æ›´æ–°è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š

- âœ… å¿«é€Ÿé›†æˆè‡ªåŠ¨æ›´æ–°åŠŸèƒ½
- âœ… æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„é›†æˆæ–¹æ¡ˆ
- âœ… è‡ªå®šä¹‰å’Œæ‰©å±•æ›´æ–°åŠŸèƒ½
- âœ… è§£å†³å¸¸è§çš„é›†æˆé—®é¢˜
- âœ… éµå¾ªæœ€ä½³å®è·µä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

å¸Œæœ›è¿™ä¸ªæ¨¡å—èƒ½å¤Ÿå¸®åŠ©æ‚¨çš„åº”ç”¨ç¨‹åºä¿æŒæœ€æ–°çŠ¶æ€ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ä½“éªŒï¼

---

**ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ27æ—¥
**ç»´æŠ¤è€…**: AutoUpdaterå¼€å‘å›¢é˜Ÿ